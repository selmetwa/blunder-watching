{"version":3,"file":"hot/scripts/content.215a09f3f03036a5973a.hot-update.js","mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACzKA","sources":["webpack://blunder-watching/./scripts/content.ts","webpack://blunder-watching/webpack/runtime/getFullHash"],"sourcesContent":["if (import.meta.webpackHot) {\n  import.meta.webpackHot.accept();\n}\n;\nconsole.log(\"content script loaded!\");\nimport { generateChessboard } from './utils/generate-chess-board';\nimport { fileLetterToNumberMap } from './constants';\nconst board = document.querySelector('wc-chess-board');\nlet classString = '';\nfunction calculateColor(attackers, defenders) {\n  const reds = ['rgba(197, 150, 151, 1)', 'rgba(190, 137, 137, 1)', 'rgba(183, 123, 123, 1)', 'rgba(175, 110, 110, 1)', 'rgba(168, 97, 97, 1)', 'rgba(158, 87, 87, 1)', 'rgba(151, 74, 74, 1)', 'rgba(144, 61, 61, 1)'];\n  const greens = ['rgba(151, 196, 175, 1)', 'rgba(129, 177, 158, 1)', 'rgba(108, 158, 141, 1)', 'rgba(86, 139, 124, 1)', 'rgba(65, 120, 107, 1)', 'rgba(43, 101, 90, 1)', 'rgba(22, 82, 73, 1)', 'rgba(0, 63, 56, 1)'];\n  if (attackers === defenders) {\n    return 'rgba(201, 240, 255, 1)'; // make this blue\n  }\n  if (attackers > defenders) {\n    return reds[attackers - defenders - 1];\n  }\n  if (defenders > attackers) {\n    return greens[defenders - attackers - 1];\n  }\n}\nfunction findStringDifference(str1, str2) {\n  let diff = '';\n  for (let i = 0; i < Math.min(str1.length, str2.length); i++) {\n    if (str1[i] !== str2[i]) {\n      diff += str2[i];\n    }\n  }\n  return diff;\n}\nfunction calculate(pieceMoved = '') {\n  const childNodes = board && board.childNodes;\n  if (!childNodes) {\n    return;\n  }\n  const pieceNodes = Array.from(childNodes).filter(node => {\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      const elementNode = node;\n      return elementNode.classList.contains('piece');\n    }\n    return false;\n  });\n  const emptyNodes = Array.from(childNodes).filter(node => {\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      const elementNode = node;\n      return elementNode.classList.contains('empty');\n    }\n    return false;\n  });\n  emptyNodes.forEach(childNode => {\n    board.removeChild(childNode);\n  });\n  const _classString = pieceNodes.map(node => `${node.classList[1]}_${node.classList[2]}`).join('_');\n  classString = _classString;\n  const chessboard = generateChessboard(pieceNodes);\n  const flatChessboard = chessboard.flat();\n  console.log({\n    flatChessboard,\n    childNodes,\n    emptyNodes\n  });\n  for (const square of flatChessboard) {\n    const [file, rank] = square && square.square && square?.square?.split('') || [];\n    const selector = `.square-${fileLetterToNumberMap[file]}${rank}`;\n    const squareElements = document.querySelectorAll(selector);\n    if (square.type === 'e') {\n      const color = calculateColor(square.attackers.length, square.defenders.length);\n      const emptySquare = document.createElement('div');\n      emptySquare.style.backgroundSize = '100%';\n      emptySquare.style.cursor = 'pointer'; // Setting multiple cursor styles for cross-browser compatibility\n      emptySquare.style.cursor = 'grab';\n      emptySquare.style.cursor = '-webkit-grab';\n      emptySquare.style.height = '12.5%';\n      emptySquare.style.left = '0';\n      emptySquare.style.overflow = 'hidden';\n      emptySquare.style.position = 'absolute';\n      emptySquare.style.top = '0';\n      emptySquare.style.touchAction = 'none';\n      emptySquare.style.width = '12.5%';\n      emptySquare.style.willChange = 'transform';\n      emptySquare.style.outline = '1px solid black';\n      emptySquare.style.backgroundColor = color;\n      emptySquare.classList.add('empty');\n      emptySquare.classList.add(`square-${fileLetterToNumberMap[file]}${rank}`);\n      const childDiv = document.createElement('div');\n      childDiv.classList.add('attackers-defenders');\n      const childText = document.createElement('p');\n      childText.style.fontSize = '12px';\n      childDiv.style.padding = '2px';\n      childText.innerText = `${square.defenders.length - square.attackers.length}`;\n      childDiv.appendChild(childText);\n      emptySquare.appendChild(childDiv);\n      board.appendChild(emptySquare);\n    }\n    squareElements.forEach(squareElement => {\n      const children = squareElement?.querySelectorAll('.attackers-defenders');\n      children?.forEach(child => {\n        squareElement?.removeChild(child);\n      });\n      if (squareElement) {\n        const color = calculateColor(square.attackers.length, square.defenders.length);\n        if (color) {\n          squareElement.style.backgroundColor = color;\n        } else {\n          squareElement.style.backgroundColor = '';\n        }\n        const childDiv = document.createElement('div');\n        childDiv.classList.add('attackers-defenders');\n        const childText = document.createElement('p');\n        childText.style.fontSize = '12px';\n        childDiv.style.padding = '2px';\n        childText.innerText = `${square.defenders.length - square.attackers.length}`;\n        childDiv.appendChild(childText);\n        squareElement.style.outline = '1px solid black';\n        squareElement.appendChild(childDiv);\n      }\n    });\n  }\n  if (pieceMoved) {\n    const joinedSelector = pieceMoved.split(' ').join('.');\n    const pieceMovedElement = document.querySelector(`.${joinedSelector}`);\n    if (pieceMovedElement) {\n      const children = pieceMovedElement?.querySelectorAll('.attackers-defenders');\n      children?.forEach(child => {\n        pieceMovedElement?.removeChild(child);\n      });\n    }\n  }\n}\ncalculate();\nfunction testing(pieceMoved) {\n  const childNodes = board && board.childNodes;\n  if (!childNodes) {\n    return;\n  }\n  const pieceNodes = Array.from(childNodes).filter(node => {\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      const elementNode = node;\n      return elementNode.classList.contains('piece');\n    }\n    return false;\n  });\n  const _classString = pieceNodes.map(node => `${node.classList[1]}_${node.classList[2]}`).join('_');\n  const diff = findStringDifference(classString, _classString);\n  if (!!diff.trim()) {\n    classString = _classString;\n    calculate(pieceMoved);\n  }\n}\nconst observer = new MutationObserver(mutationsList => {\n  mutationsList.forEach(mutation => {\n    if (mutation.type === 'attributes') {\n      if (mutation.attributeName === 'class') {\n        const targetNode = mutation.target;\n        if (targetNode.classList.contains('piece') && !targetNode.classList.contains('dragging')) {\n          testing(targetNode.classList.value);\n        }\n      }\n    }\n  });\n});\nif (board && board.childNodes) {\n  board.childNodes.forEach(node => {\n    observer.observe(node, {\n      attributes: true,\n      attributeFilter: ['class']\n    });\n  });\n}","__webpack_require__.h = () => (\"76e11505777e2a8d8f9c\")"],"names":[],"sourceRoot":""}